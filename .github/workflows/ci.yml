name: Cypress CI - E2E and API Tests

# Run workflow on every push and pull request
on: [push, pull_request]

jobs:
  cypress-run:
    # Use a clean Ubuntu runner environment
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout the repository code
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Install Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a recent LTS version

      # 3. Cypress Action
      # This action handles caching, installing dependencies (including Cypress and TypeScript),
      # and running the 'cypress run' command efficiently.
      - name: Run Cypress Tests
        uses: cypress-io/github-action@v6
        with:
          # Specify the browser to run tests in (e.g., chrome, firefox, edge)
          browser: chrome
          # Since we test an external site, we let Cypress use its default setup.
          
      # 4. Upload Artifacts (ONLY runs if the previous steps failed)
      - name: Upload Artifacts (on failure)
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: cypress-execution-artifacts
          # These paths are standard Cypress outputs for screenshots and videos
          path: |
            cypress/screenshots
            cypress/videos
            